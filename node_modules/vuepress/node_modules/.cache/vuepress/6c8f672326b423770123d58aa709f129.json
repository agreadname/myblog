{"remainingRequest":"G:\\full\\myBolg\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!G:\\full\\myBolg\\docs\\.vuepress\\components\\verifychip\\constructor.js","dependencies":[{"path":"G:\\full\\myBolg\\docs\\.vuepress\\components\\verifychip\\constructor.js","mtime":1551347074892},{"path":"G:\\full\\myBolg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1545827198486},{"path":"G:\\full\\myBolg\\node_modules\\babel-loader\\lib\\index.js","mtime":1551338590818}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.map\";\nimport \"core-js/modules/es6.array.reduce\";\nimport \"core-js/modules/es6.object.assign\";\nimport _classCallCheck from \"G:\\\\full\\\\myBolg\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/classCallCheck\";\nimport _createClass from \"G:\\\\full\\\\myBolg\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/createClass\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.date.to-string\";\nimport \"core-js/modules/es6.array.is-array\";\n//canvas拼图构造器\nvar l = 42,\n    // 滑块边长\nr = 9,\n    // 滑块半径\nw = 310,\n    // canvas宽度\nh = 155,\n    // canvas高度\nPI = Math.PI;\nvar _url = \"\";\nvar L = l + r * 2 + 3; // 滑块实际边长\n// const isIE = window.navigator.userAgent.indexOf(\"Trident\") > -1;\n\nvar isIE = false; //随机数\n\nfunction getRandomNumberByRange(start, end) {\n  return Math.round(Math.random() * (end - start) + start);\n} //创作canvas标签\n\n\nfunction createCanvas(width, height) {\n  var canvas = document.createElement(\"canvas\");\n  canvas.width = width;\n  canvas.height = height;\n  return canvas;\n} //加载图片\n\n\nfunction createImg(onload) {\n  var img = new Image();\n  img.crossOrigin = \"Anonymous\";\n  img.onload = onload;\n\n  img.onerror = function () {\n    img.setSrc(getRandomImgSrc());\n  };\n\n  img.setSrc = function (src) {\n    if (isIE) {\n      // IE浏览器无法通过img.crossOrigin跨域，使用ajax获取图片blob然后转为dataURL显示\n      var xhr = new XMLHttpRequest();\n\n      xhr.onloadend = function (e) {\n        var file = new FileReader(); // FileReader仅支持IE10+\n\n        file.readAsDataURL(e.target.response);\n\n        file.onloadend = function (e) {\n          img.src = e.target.result;\n        };\n      };\n\n      xhr.open(\"GET\", src);\n      xhr.responseType = \"blob\";\n      xhr.send();\n    } else img.src = src;\n  };\n\n  img.setSrc(getRandomImgSrc());\n  return img;\n}\n\nfunction createElement(tagName, className) {\n  var elment = document.createElement(tagName);\n  elment.className = className;\n  return elment;\n}\n\nfunction addClass(tag, className) {\n  tag.classList.add(className);\n}\n\nfunction removeClass(tag, className) {\n  tag.classList.remove(className);\n} //获取图片路径\n\n\nfunction getRandomImgSrc() {\n  return _url;\n} //用到上面定义内容\n\n\nfunction _draw(ctx, x, y, operation) {\n  ctx.beginPath();\n  ctx.moveTo(x, y);\n  ctx.arc(x + l / 2, y - r + 2, r, 0.72 * PI, 2.26 * PI);\n  ctx.lineTo(x + l, y);\n  ctx.arc(x + l + r - 2, y + l / 2, r, 1.21 * PI, 2.78 * PI);\n  ctx.lineTo(x + l, y + l);\n  ctx.lineTo(x, y + l);\n  ctx.arc(x + r - 2, y + l / 2, r + 0.4, 2.76 * PI, 1.24 * PI, true);\n  ctx.lineTo(x, y);\n  ctx.lineWidth = 2;\n  ctx.fillStyle = \"rgba(255, 255, 255, .9)\";\n  ctx.strokeStyle = \"rgba(255, 255, 255, .9)\";\n  ctx.stroke();\n  ctx[operation]();\n  ctx.globalCompositeOperation = isIE ? \"xor\" : \"overlay\";\n}\n\nfunction sum(x, y) {\n  return x + y;\n}\n\nfunction square(x) {\n  return x * x;\n} //判断是否为数组\n\n\nfunction _isArray(arg) {\n  if (!Array.isArray) {\n    Array.isArray = function (arg) {\n      return Object.prototype.toString.call(arg) === \"[object Array]\";\n    };\n  } else {\n    return Array.isArray(arg);\n  }\n} //定义类\n\n\nvar Tkstree =\n/*#__PURE__*/\nfunction () {\n  function Tkstree(_ref) {\n    var el = _ref.el,\n        onSuccess = _ref.onSuccess,\n        onFail = _ref.onFail,\n        onRefresh = _ref.onRefresh,\n        url = _ref.url,\n        images = _ref.images;\n\n    _classCallCheck(this, Tkstree);\n\n    el.style.position = \"relative\";\n    el.style.width = w + \"px\";\n    Object.assign(el.style, {\n      position: \"relative\",\n      width: w + \"px\" // margin: '0 auto'\n\n    });\n    this.el = el;\n    this.onSuccess = onSuccess;\n    this.onFail = onFail;\n    this.onRefresh = onRefresh;\n    _url = url;\n  }\n\n  _createClass(Tkstree, [{\n    key: \"init\",\n    value: function init() {\n      this.initDOM();\n      this.initImg();\n      this.bindEvents();\n    }\n  }, {\n    key: \"initDOM\",\n    value: function initDOM() {\n      var canvas = createCanvas(w, h); // 画布\n\n      var block = canvas.cloneNode(true); // 滑块\n\n      var sliderContainer = createElement(\"div\", \"sliderContainer\");\n      var refreshIcon = createElement(\"div\", \"refreshIcon\");\n      var sliderMask = createElement(\"div\", \"sliderMask\");\n      var slider = createElement(\"div\", \"slider\");\n      var sliderIcon = createElement(\"span\", \"sliderIcon\");\n      var text = createElement(\"span\", \"sliderText\");\n      block.className = \"block\";\n      text.innerHTML = \"向右滑动填充拼图\";\n      var el = this.el;\n      el.appendChild(canvas);\n      el.appendChild(refreshIcon);\n      el.appendChild(block);\n      slider.appendChild(sliderIcon);\n      sliderMask.appendChild(slider);\n      sliderContainer.appendChild(sliderMask);\n      sliderContainer.appendChild(text);\n      el.appendChild(sliderContainer);\n      Object.assign(this, {\n        canvas: canvas,\n        block: block,\n        sliderContainer: sliderContainer,\n        refreshIcon: refreshIcon,\n        slider: slider,\n        sliderMask: sliderMask,\n        sliderIcon: sliderIcon,\n        text: text,\n        canvasCtx: canvas.getContext(\"2d\"),\n        blockCtx: block.getContext(\"2d\")\n      });\n    }\n  }, {\n    key: \"initImg\",\n    value: function initImg() {\n      var _this = this;\n\n      var img = createImg(function () {\n        _this.draw();\n\n        _this.canvasCtx.drawImage(img, 0, 0, w, h);\n\n        _this.blockCtx.drawImage(img, 0, 0, w, h);\n\n        var y = _this.y - r * 2 - 1;\n\n        var ImageData = _this.blockCtx.getImageData(_this.x - 3, y, L, L);\n\n        _this.block.width = L;\n\n        _this.blockCtx.putImageData(ImageData, 0, y);\n      });\n      this.img = img;\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      // 随机创建滑块的位置\n      this.x = getRandomNumberByRange(L + 10, w - (L + 10));\n      this.y = getRandomNumberByRange(10 + r * 2, h - (L + 10));\n\n      _draw(this.canvasCtx, this.x, this.y, \"fill\");\n\n      _draw(this.blockCtx, this.x, this.y, \"clip\");\n    }\n  }, {\n    key: \"clean\",\n    value: function clean() {\n      this.canvasCtx.clearRect(0, 0, w, h);\n      this.blockCtx.clearRect(0, 0, w, h);\n      this.block.width = w;\n    }\n  }, {\n    key: \"bindEvents\",\n    value: function bindEvents() {\n      var _this2 = this;\n\n      this.el.onselectstart = function () {\n        return false;\n      };\n\n      this.refreshIcon.onclick = function () {\n        _this2.reset();\n\n        typeof _this2.onRefresh === \"function\" && _this2.onRefresh();\n      };\n\n      var originX,\n          originY,\n          trail = [],\n          isMouseDown = false;\n\n      var handleDragStart = function handleDragStart(e) {\n        originX = e.clientX || e.touches[0].clientX;\n        originY = e.clientY || e.touches[0].clientY;\n        isMouseDown = true;\n      };\n\n      var handleDragMove = function handleDragMove(e) {\n        if (!isMouseDown) return false;\n        var eventX = e.clientX || e.touches[0].clientX;\n        var eventY = e.clientY || e.touches[0].clientY;\n        var moveX = eventX - originX;\n        var moveY = eventY - originY;\n        if (moveX < 0 || moveX + 38 >= w) return false;\n        _this2.slider.style.left = moveX + \"px\";\n        var blockLeft = (w - 40 - 20) / (w - 40) * moveX;\n        _this2.block.style.left = blockLeft + \"px\";\n        addClass(_this2.sliderContainer, \"sliderContainer_active\");\n        _this2.sliderMask.style.width = moveX + \"px\";\n        trail.push(moveY);\n      };\n\n      var handleDragEnd = function handleDragEnd(e) {\n        if (!isMouseDown) return false;\n        isMouseDown = false;\n        var eventX = e.clientX || e.changedTouches[0].clientX;\n        if (eventX == originX) return false;\n        removeClass(_this2.sliderContainer, \"sliderContainer_active\");\n        _this2.trail = trail;\n\n        var _this2$verify = _this2.verify(),\n            spliced = _this2$verify.spliced,\n            verified = _this2$verify.verified;\n\n        if (spliced) {\n          if (verified) {\n            addClass(_this2.sliderContainer, \"sliderContainer_success\");\n            typeof _this2.onSuccess === \"function\" && _this2.onSuccess();\n          } else {\n            addClass(_this2.sliderContainer, \"sliderContainer_fail\");\n            _this2.text.innerHTML = \"再试一次\";\n\n            _this2.reset();\n          }\n        } else {\n          addClass(_this2.sliderContainer, \"sliderContainer_fail\");\n          typeof _this2.onFail === \"function\" && _this2.onFail();\n          setTimeout(function () {\n            _this2.reset();\n          }, 1000);\n        }\n      };\n\n      this.slider.addEventListener(\"mousedown\", handleDragStart);\n      this.slider.addEventListener(\"touchstart\", handleDragStart);\n      document.addEventListener(\"mousemove\", handleDragMove);\n      document.addEventListener(\"touchmove\", handleDragMove);\n      document.addEventListener(\"mouseup\", handleDragEnd);\n      document.addEventListener(\"touchend\", handleDragEnd);\n    }\n  }, {\n    key: \"verify\",\n    value: function verify() {\n      var arr = this.trail; // 拖动时y轴的移动距离\n\n      var average = arr.reduce(sum) / arr.length;\n      var deviations = arr.map(function (x) {\n        return x - average;\n      });\n      var stddev = Math.sqrt(deviations.map(square).reduce(sum) / arr.length);\n      var left = parseInt(this.block.style.left);\n      return {\n        spliced: Math.abs(left - this.x) < 10,\n        verified: stddev !== 0 // 简单验证下拖动轨迹，为零时表示Y轴上下没有波动，可能非人为操作\n\n      };\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.sliderContainer.className = \"sliderContainer\";\n      this.slider.style.left = 0;\n      this.block.style.left = 0;\n      this.sliderMask.style.width = 0;\n      this.clean();\n      this.img.setSrc(getRandomImgSrc());\n    }\n  }]);\n\n  return Tkstree;\n}();\n\nvar _canvas = {\n  init: function init(opts) {\n    return new Tkstree(opts).init();\n  }\n};\nexport { _canvas };",{"version":3,"sources":["docs\\.vuepress\\components\\verifychip\\constructor.js"],"names":["l","r","w","h","PI","Math","_url","L","isIE","getRandomNumberByRange","start","end","round","random","createCanvas","width","height","canvas","document","createElement","createImg","onload","img","Image","crossOrigin","onerror","setSrc","getRandomImgSrc","src","xhr","XMLHttpRequest","onloadend","e","file","FileReader","readAsDataURL","target","response","result","open","responseType","send","tagName","className","elment","addClass","tag","classList","add","removeClass","remove","draw","ctx","x","y","operation","beginPath","moveTo","arc","lineTo","lineWidth","fillStyle","strokeStyle","stroke","globalCompositeOperation","sum","square","_isArray","arg","Array","isArray","Object","prototype","toString","call","Tkstree","el","onSuccess","onFail","onRefresh","url","images","style","position","assign","initDOM","initImg","bindEvents","block","cloneNode","sliderContainer","refreshIcon","sliderMask","slider","sliderIcon","text","innerHTML","appendChild","canvasCtx","getContext","blockCtx","drawImage","ImageData","getImageData","putImageData","clearRect","onselectstart","onclick","reset","originX","originY","trail","isMouseDown","handleDragStart","clientX","touches","clientY","handleDragMove","eventX","eventY","moveX","moveY","left","blockLeft","push","handleDragEnd","changedTouches","verify","spliced","verified","setTimeout","addEventListener","arr","average","reduce","length","deviations","map","stddev","sqrt","parseInt","abs","clean","_canvas","init","opts"],"mappings":"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","sourceRoot":"G:\\full\\myBolg","sourcesContent":["//canvas拼图构造器\r\nconst l = 42, // 滑块边长\r\n  r = 9, // 滑块半径\r\n  w = 310, // canvas宽度\r\n  h = 155, // canvas高度\r\n  PI = Math.PI;\r\nvar _url = \"\";\r\nconst L = l + r * 2 + 3; // 滑块实际边长\r\n// const isIE = window.navigator.userAgent.indexOf(\"Trident\") > -1;\r\nconst isIE = false\r\n//随机数\r\nfunction getRandomNumberByRange(start, end) {\r\n  return Math.round(Math.random() * (end - start) + start);\r\n}\r\n//创作canvas标签\r\nfunction createCanvas(width, height) {\r\n  const canvas = document.createElement(\"canvas\");\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  return canvas;\r\n}\r\n//加载图片\r\nfunction createImg(onload) {\r\n  const img = new Image();\r\n  img.crossOrigin = \"Anonymous\";\r\n  img.onload = onload;\r\n  img.onerror = () => {\r\n    img.setSrc(getRandomImgSrc());\r\n  };\r\n\r\n  img.setSrc = function(src) {\r\n    if (isIE) {\r\n      // IE浏览器无法通过img.crossOrigin跨域，使用ajax获取图片blob然后转为dataURL显示\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.onloadend = function(e) {\r\n        const file = new FileReader(); // FileReader仅支持IE10+\r\n        file.readAsDataURL(e.target.response);\r\n        file.onloadend = function(e) {\r\n          img.src = e.target.result;\r\n        };\r\n      };\r\n      xhr.open(\"GET\", src);\r\n      xhr.responseType = \"blob\";\r\n      xhr.send();\r\n    } else img.src = src;\r\n  };\r\n\r\n  img.setSrc(getRandomImgSrc());\r\n  return img;\r\n}\r\n\r\nfunction createElement(tagName, className) {\r\n  const elment = document.createElement(tagName);\r\n  elment.className = className;\r\n  return elment;\r\n}\r\n\r\nfunction addClass(tag, className) {\r\n  tag.classList.add(className);\r\n}\r\n\r\nfunction removeClass(tag, className) {\r\n  tag.classList.remove(className);\r\n}\r\n//获取图片路径\r\nfunction getRandomImgSrc() {\r\n  return _url;\r\n}\r\n//用到上面定义内容\r\nfunction draw(ctx, x, y, operation) {\r\n  ctx.beginPath();\r\n  ctx.moveTo(x, y);\r\n  ctx.arc(x + l / 2, y - r + 2, r, 0.72 * PI, 2.26 * PI);\r\n  ctx.lineTo(x + l, y);\r\n  ctx.arc(x + l + r - 2, y + l / 2, r, 1.21 * PI, 2.78 * PI);\r\n  ctx.lineTo(x + l, y + l);\r\n  ctx.lineTo(x, y + l);\r\n  ctx.arc(x + r - 2, y + l / 2, r + 0.4, 2.76 * PI, 1.24 * PI, true);\r\n  ctx.lineTo(x, y);\r\n  ctx.lineWidth = 2;\r\n  ctx.fillStyle = \"rgba(255, 255, 255, .9)\";\r\n  ctx.strokeStyle = \"rgba(255, 255, 255, .9)\";\r\n  ctx.stroke();\r\n  ctx[operation]();\r\n  ctx.globalCompositeOperation = isIE ? \"xor\" : \"overlay\";\r\n}\r\n\r\nfunction sum(x, y) {\r\n  return x + y;\r\n}\r\n\r\nfunction square(x) {\r\n  return x * x;\r\n}\r\n//判断是否为数组\r\nfunction _isArray(arg) {\r\n  if (!Array.isArray) {\r\n    Array.isArray = function(arg) {\r\n      return Object.prototype.toString.call(arg) === \"[object Array]\";\r\n    };\r\n  } else {\r\n    return Array.isArray(arg);\r\n  }\r\n}\r\n\r\n//定义类\r\nclass Tkstree {\r\n  constructor({\r\n    el,\r\n    onSuccess,\r\n    onFail,\r\n    onRefresh,\r\n    url, //图片路径\r\n    images //图片名字\r\n  }) {\r\n    el.style.position = \"relative\";\r\n    el.style.width = w + \"px\";\r\n    Object.assign(el.style, {\r\n      position: \"relative\",\r\n      width: w + \"px\"\r\n      // margin: '0 auto'\r\n    });\r\n    this.el = el;\r\n    this.onSuccess = onSuccess;\r\n    this.onFail = onFail;\r\n    this.onRefresh = onRefresh;\r\n    _url = url;\r\n  }\r\n\r\n  init() {\r\n    this.initDOM();\r\n    this.initImg();\r\n    this.bindEvents();\r\n  }\r\n\r\n  initDOM() {\r\n    const canvas = createCanvas(w, h); // 画布\r\n    const block = canvas.cloneNode(true); // 滑块\r\n    const sliderContainer = createElement(\"div\", \"sliderContainer\");\r\n    const refreshIcon = createElement(\"div\", \"refreshIcon\");\r\n    const sliderMask = createElement(\"div\", \"sliderMask\");\r\n    const slider = createElement(\"div\", \"slider\");\r\n    const sliderIcon = createElement(\"span\", \"sliderIcon\");\r\n    const text = createElement(\"span\", \"sliderText\");\r\n    block.className = \"block\";\r\n    text.innerHTML = \"向右滑动填充拼图\";\r\n    const el = this.el;\r\n    el.appendChild(canvas);\r\n    el.appendChild(refreshIcon);\r\n    el.appendChild(block);\r\n    slider.appendChild(sliderIcon);\r\n    sliderMask.appendChild(slider);\r\n    sliderContainer.appendChild(sliderMask);\r\n    sliderContainer.appendChild(text);\r\n    el.appendChild(sliderContainer);\r\n\r\n    Object.assign(this, {\r\n      canvas,\r\n      block,\r\n      sliderContainer,\r\n      refreshIcon,\r\n      slider,\r\n      sliderMask,\r\n      sliderIcon,\r\n      text,\r\n      canvasCtx: canvas.getContext(\"2d\"),\r\n      blockCtx: block.getContext(\"2d\")\r\n    });\r\n  }\r\n\r\n  initImg() {\r\n    const img = createImg(() => {\r\n      this.draw();\r\n      this.canvasCtx.drawImage(img, 0, 0, w, h);\r\n      this.blockCtx.drawImage(img, 0, 0, w, h);\r\n      const y = this.y - r * 2 - 1;\r\n      const ImageData = this.blockCtx.getImageData(this.x - 3, y, L, L);\r\n      this.block.width = L;\r\n      this.blockCtx.putImageData(ImageData, 0, y);\r\n    });\r\n    this.img = img;\r\n  }\r\n\r\n  draw() {\r\n    // 随机创建滑块的位置\r\n    this.x = getRandomNumberByRange(L + 10, w - (L + 10));\r\n    this.y = getRandomNumberByRange(10 + r * 2, h - (L + 10));\r\n    draw(this.canvasCtx, this.x, this.y, \"fill\");\r\n    draw(this.blockCtx, this.x, this.y, \"clip\");\r\n  }\r\n\r\n  clean() {\r\n    this.canvasCtx.clearRect(0, 0, w, h);\r\n    this.blockCtx.clearRect(0, 0, w, h);\r\n    this.block.width = w;\r\n  }\r\n\r\n  bindEvents() {\r\n    this.el.onselectstart = () => false;\r\n    this.refreshIcon.onclick = () => {\r\n      this.reset();\r\n      typeof this.onRefresh === \"function\" && this.onRefresh();\r\n    };\r\n\r\n    let originX,\r\n      originY,\r\n      trail = [],\r\n      isMouseDown = false;\r\n\r\n    const handleDragStart = function(e) {\r\n      originX = e.clientX || e.touches[0].clientX;\r\n      originY = e.clientY || e.touches[0].clientY;\r\n      isMouseDown = true;\r\n    };\r\n\r\n    const handleDragMove = e => {\r\n      if (!isMouseDown) return false;\r\n      const eventX = e.clientX || e.touches[0].clientX;\r\n      const eventY = e.clientY || e.touches[0].clientY;\r\n      const moveX = eventX - originX;\r\n      const moveY = eventY - originY;\r\n      if (moveX < 0 || moveX + 38 >= w) return false;\r\n      this.slider.style.left = moveX + \"px\";\r\n      const blockLeft = ((w - 40 - 20) / (w - 40)) * moveX;\r\n      this.block.style.left = blockLeft + \"px\";\r\n\r\n      addClass(this.sliderContainer, \"sliderContainer_active\");\r\n      this.sliderMask.style.width = moveX + \"px\";\r\n      trail.push(moveY);\r\n    };\r\n\r\n    const handleDragEnd = e => {\r\n      if (!isMouseDown) return false;\r\n      isMouseDown = false;\r\n      const eventX = e.clientX || e.changedTouches[0].clientX;\r\n      if (eventX == originX) return false;\r\n      removeClass(this.sliderContainer, \"sliderContainer_active\");\r\n      this.trail = trail;\r\n      const { spliced, verified } = this.verify();\r\n      if (spliced) {\r\n        if (verified) {\r\n          addClass(this.sliderContainer, \"sliderContainer_success\");\r\n          typeof this.onSuccess === \"function\" && this.onSuccess();\r\n        } else {\r\n          addClass(this.sliderContainer, \"sliderContainer_fail\");\r\n          this.text.innerHTML = \"再试一次\";\r\n          this.reset();\r\n        }\r\n      } else {\r\n        addClass(this.sliderContainer, \"sliderContainer_fail\");\r\n        typeof this.onFail === \"function\" && this.onFail();\r\n        setTimeout(() => {\r\n          this.reset();\r\n        }, 1000);\r\n      }\r\n    };\r\n    this.slider.addEventListener(\"mousedown\", handleDragStart);\r\n    this.slider.addEventListener(\"touchstart\", handleDragStart);\r\n    document.addEventListener(\"mousemove\", handleDragMove);\r\n    document.addEventListener(\"touchmove\", handleDragMove);\r\n    document.addEventListener(\"mouseup\", handleDragEnd);\r\n    document.addEventListener(\"touchend\", handleDragEnd);\r\n  }\r\n\r\n  verify() {\r\n    const arr = this.trail; // 拖动时y轴的移动距离\r\n    const average = arr.reduce(sum) / arr.length;\r\n    const deviations = arr.map(x => x - average);\r\n    const stddev = Math.sqrt(deviations.map(square).reduce(sum) / arr.length);\r\n    const left = parseInt(this.block.style.left);\r\n    return {\r\n      spliced: Math.abs(left - this.x) < 10,\r\n      verified: stddev !== 0 // 简单验证下拖动轨迹，为零时表示Y轴上下没有波动，可能非人为操作\r\n    };\r\n  }\r\n\r\n  reset() {\r\n    this.sliderContainer.className = \"sliderContainer\";\r\n    this.slider.style.left = 0;\r\n    this.block.style.left = 0;\r\n    this.sliderMask.style.width = 0;\r\n    this.clean();\r\n    this.img.setSrc(getRandomImgSrc());\r\n  }\r\n}\r\n\r\nvar _canvas = {\r\n  init: function(opts) {\r\n    return new Tkstree(opts).init();\r\n  }\r\n};\r\nexport { _canvas };\r\n"]}]}