{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{499:function(e,t,n){\"use strict\";var i=n(3),r=n(500);i(i.P+i.F*!n(30)([].reduce,!0),\"Array\",{reduce:function(e){return r(this,e,arguments.length,arguments[1],!1)}})},500:function(e,t,n){var i=n(37),r=n(39),s=n(74),a=n(73);e.exports=function(e,t,n,o,c){i(t);var l=r(e),u=s(l),d=a(l.length),h=c?d-1:0,f=c?-1:1;if(n<2)for(;;){if(h in u){o=u[h],h+=f;break}if(h+=f,c?h<0:d<=h)throw TypeError(\"Reduce of empty array with no initial value\")}for(;c?h>=0:d>h;h+=f)h in u&&(o=t(o,u[h],h,l));return o}},501:function(e,t,n){\"use strict\";n(502);var i=n(10),r=n(154),s=n(8),a=/./.toString,o=function(e){n(13)(RegExp.prototype,\"toString\",e,!0)};n(7)(function(){return\"/a/b\"!=a.call({source:\"a\",flags:\"b\"})})?o(function(){var e=i(this);return\"/\".concat(e.source,\"/\",\"flags\"in e?e.flags:!s&&e instanceof RegExp?r.call(e):void 0)}):\"toString\"!=a.name&&o(function(){return a.call(this)})},502:function(e,t,n){n(8)&&\"g\"!=/./g.flags&&n(9).f(RegExp.prototype,\"flags\",{configurable:!0,get:n(154)})},503:function(e,t,n){var i=Date.prototype,r=i.toString,s=i.getTime;new Date(NaN)+\"\"!=\"Invalid Date\"&&n(13)(i,\"toString\",function(){var e=s.call(this);return e==e?r.call(this):\"Invalid Date\"})},504:function(e,t,n){},506:function(e,t,n){\"use strict\";n.r(t);n(41),n(499),n(38);var i=n(148),r=n(149),s=(n(501),n(503),n(155),n(75),n(504),42),a=9,o=310,c=155,l=Math.PI,u=\"\",d=s+2*a+3,h=window.navigator.userAgent.indexOf(\"Trident\")>-1;function f(e,t){return Math.round(Math.random()*(t-e)+e)}function v(e,t){var n=document.createElement(e);return n.className=t,n}function p(e,t){e.classList.add(t)}function g(){return u}function m(e,t,n,i){e.beginPath(),e.moveTo(t,n),e.arc(t+s/2,n-a+2,a,.72*l,2.26*l),e.lineTo(t+s,n),e.arc(t+s+a-2,n+s/2,a,1.21*l,2.78*l),e.lineTo(t+s,n+s),e.lineTo(t,n+s),e.arc(t+a-2,n+s/2,a+.4,2.76*l,1.24*l,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle=\"rgba(255, 255, 255, .9)\",e.strokeStyle=\"rgba(255, 255, 255, .9)\",e.stroke(),e[i](),e.globalCompositeOperation=h?\"xor\":\"overlay\"}function y(e,t){return e+t}function C(e){return e*e}var b=function(){function e(t){var n=t.el,r=t.onSuccess,s=t.onFail,a=t.onRefresh,c=t.url;t.images;Object(i.a)(this,e),n.style.position=\"relative\",n.style.width=o+\"px\",Object.assign(n.style,{position:\"relative\",width:o+\"px\"}),this.el=n,this.onSuccess=r,this.onFail=s,this.onRefresh=a,u=c}return Object(r.a)(e,[{key:\"init\",value:function(){this.initDOM(),this.initImg(),this.bindEvents()}},{key:\"initDOM\",value:function(){var e=function(e,t){var n=document.createElement(\"canvas\");return n.width=e,n.height=t,n}(o,c),t=e.cloneNode(!0),n=v(\"div\",\"sliderContainer\"),i=v(\"div\",\"refreshIcon\"),r=v(\"div\",\"sliderMask\"),s=v(\"div\",\"slider\"),a=v(\"span\",\"sliderIcon\"),l=v(\"span\",\"sliderText\");t.className=\"block\",l.innerHTML=\"向右滑动填充拼图\";var u=this.el;u.appendChild(e),u.appendChild(i),u.appendChild(t),s.appendChild(a),r.appendChild(s),n.appendChild(r),n.appendChild(l),u.appendChild(n),Object.assign(this,{canvas:e,block:t,sliderContainer:n,refreshIcon:i,slider:s,sliderMask:r,sliderIcon:a,text:l,canvasCtx:e.getContext(\"2d\"),blockCtx:t.getContext(\"2d\")})}},{key:\"initImg\",value:function(){var e=this,t=function(e){var t=new Image;return t.crossOrigin=\"Anonymous\",t.onload=e,t.onerror=function(){t.setSrc(g())},t.setSrc=function(e){if(h){var n=new XMLHttpRequest;n.onloadend=function(e){var n=new FileReader;n.readAsDataURL(e.target.response),n.onloadend=function(e){t.src=e.target.result}},n.open(\"GET\",e),n.responseType=\"blob\",n.send()}else t.src=e},t.setSrc(g()),t}(function(){e.draw(),e.canvasCtx.drawImage(t,0,0,o,c),e.blockCtx.drawImage(t,0,0,o,c);var n=e.y-2*a-1,i=e.blockCtx.getImageData(e.x-3,n,d,d);e.block.width=d,e.blockCtx.putImageData(i,0,n)});this.img=t}},{key:\"draw\",value:function(){this.x=f(d+10,o-(d+10)),this.y=f(10+2*a,c-(d+10)),m(this.canvasCtx,this.x,this.y,\"fill\"),m(this.blockCtx,this.x,this.y,\"clip\")}},{key:\"clean\",value:function(){this.canvasCtx.clearRect(0,0,o,c),this.blockCtx.clearRect(0,0,o,c),this.block.width=o}},{key:\"bindEvents\",value:function(){var e=this;this.el.onselectstart=function(){return!1},this.refreshIcon.onclick=function(){e.reset(),\"function\"==typeof e.onRefresh&&e.onRefresh()};var t,n,i=[],r=!1,s=function(e){t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,r=!0},a=function(s){if(!r)return!1;var a=s.clientX||s.touches[0].clientX,c=s.clientY||s.touches[0].clientY,l=a-t,u=c-n;if(l<0||l+38>=o)return!1;e.slider.style.left=l+\"px\";var d=(o-40-20)/(o-40)*l;e.block.style.left=d+\"px\",p(e.sliderContainer,\"sliderContainer_active\"),e.sliderMask.style.width=l+\"px\",i.push(u)},c=function(n){if(!r)return!1;var s,a;if(r=!1,(n.clientX||n.changedTouches[0].clientX)==t)return!1;s=e.sliderContainer,a=\"sliderContainer_active\",s.classList.remove(a),e.trail=i;var o=e.verify(),c=o.spliced,l=o.verified;c?l?(p(e.sliderContainer,\"sliderContainer_success\"),\"function\"==typeof e.onSuccess&&e.onSuccess()):(p(e.sliderContainer,\"sliderContainer_fail\"),e.text.innerHTML=\"再试一次\",e.reset()):(p(e.sliderContainer,\"sliderContainer_fail\"),\"function\"==typeof e.onFail&&e.onFail(),setTimeout(function(){e.reset()},1e3))};this.slider.addEventListener(\"mousedown\",s),this.slider.addEventListener(\"touchstart\",s),document.addEventListener(\"mousemove\",a),document.addEventListener(\"touchmove\",a),document.addEventListener(\"mouseup\",c),document.addEventListener(\"touchend\",c)}},{key:\"verify\",value:function(){var e=this.trail,t=e.reduce(y)/e.length,n=e.map(function(e){return e-t}),i=Math.sqrt(n.map(C).reduce(y)/e.length),r=parseInt(this.block.style.left);return{spliced:Math.abs(r-this.x)<10,verified:0!==i}}},{key:\"reset\",value:function(){this.sliderContainer.className=\"sliderContainer\",this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.img.setSrc(g())}}]),e}(),x=function(e){return new b(e).init()},k={data:function(){return{canvasKey:\"CANVAS\"+parseInt(1e5*Math.random())}},created:function(){},mounted:function(){this.initCanvas()},props:{url:{type:String,default:\"//picsum.photos/300/150/?image=\"},imgName:{type:Array}},methods:{initCanvas:function(){var e=\"//picsum.photos/300/150/?image=\"==this.url?this.url+this.getRandomNumberByRange(0,300):this.url+this.imgName[this.getRandomNumberByRange(0,this.imgName.length-1)];x({el:this.$refs[this.canvasKey],onSuccess:this.result(0),onFail:this.result(1),onRefresh:this.result(2),url:e})},result:function(e){var t=this;return function(){var n=e?2==e?\"刷新\":\"失败\":\"成功\";t.$message(\"这是\"+n+\"回调事件\"),e?2==e?t.$emit(\"onrefresh\",\"刷新回调事件\"):t.$emit(\"onfail\",\"失败回调事件\"):t.$emit(\"onsuccess\",\"成功回调事件\")}},getRandomNumberByRange:function(e,t){return Math.round(Math.random()*(t-e)+e)}}},w=n(1),R=Object(w.a)(k,function(){var e=this.$createElement;return(this._self._c||e)(\"div\",{ref:this.canvasKey,staticClass:\"wrapper\",attrs:{width:\"300px\",height:\"200px\"}})},[],!1,null,null,null);R.options.__file=\"index.vue\";t.default=R.exports}}]);","extractedComments":[]}